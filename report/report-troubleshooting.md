# Enterprise Linux Lab Report - Troubleshooting

- Student name: Maxim Eeckhout
- Class/group: TIN-TI-3B (Gent)

## Instructions

- Write a detailed report in the "Report" section below (in Dutch or English)
- Use correct Markdown! Use fenced code blocks for commands and their output, terminal transcripts, ...
- The different phases in the bottom-up troubleshooting process are described in their own subsections (heading of level 3, i.e. starting with `###`) with the name of the phase as title.
- Every step is described in detail:
    - describe what is being tested
    - give the command, including options and arguments, needed to execute the test, or the absolute path to the configuration file to be verified
    - give the expected output of the command or content of the configuration file (only the relevant parts are sufficient!)
    - if the actual output is different from the one expected, explain the cause and describe how you fixed this by giving the exact commands or necessary changes to configuration files
- In the section "End result", describe the final state of the service:
    - copy/paste a transcript of running the acceptance tests
    - describe the result of accessing the service from the host system
    - describe any error messages that still remain

## Report

### Phase 1: Physical and Network Access layer

Controle van:
* Fysieke deel (kabels aangesloten, machine staat aan?)
* Is er een IP-address?

| Test                                      | Status      |
| :---                                      | :---        |
| Staat de machine aan                      | CHECK            |
| Kabel ingestoken (VirtualBox)             | FALSE => fixed           |
| Correcte netwerkinstellingen (VirtualBox) | FALSE => fixed           |

#### IP instellingen bekijken
Command
```
[vagrant@nginx ~]$ ip -c address
```
=> Nog geen ip address!!!

#### Fouten in deze fase:
1. De kabel van Host-only adapter was niet verbonden
  * Oplossing: Verbinden van kabel in VirtualBox
2. Port Forwarding van de ssh poort staat in VirtualBox op 2202
  * Oplossing: Aanpassen van poort in VirtualBox naar 2222

### Phase 2: Internet layer
Controle van:
* Netwerkinstellingen
  * IP Address
  * Default Gateway
* Connectiviteit

#### IP Address
* Verwachtingen:
  * Er is een IP address
  * Het IP address klopt met de verwachtingen (binnen de range van de DHCP)
  * Subnetmask is correct

Controleren in ```/etc/sysconfig/network-scripts/ifcfg-enp0s8```

output:
```
[vagrant@nginx ~]$ sudo cat /etc/sysconfig/network-scripts/ifcfg-enp0s8
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
NM_CONTROLLED=yes
BOOTPROTO=none
ONBOOT=yes
IPADDR=192.168.56.42
NETMASK=255.255.255.0
DEVICE=enp0s8
PEERDNS=no
#VAGRANT-END
ZONE=public
```
=> Typefout bij IPADDR!

Ip address nu wel aanwezig:
```
[vagrant@nginx ~]$ ip -c address
...
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:b5:4a:be brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.42/24 brd 192.168.56.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:feb5:4abe/64 scope link
       valid_lft forever preferred_lft forever

```

#### Default Gateway
Commando: ```ip r ```

Output:
```
[vagrant@nginx ~]$ ip r
default via 10.0.2.2 dev enp0s3 proto dhcp metric 100
10.0.2.0/24 dev enp0s3 proto kernel scope link src 10.0.2.15 metric 100
192.168.56.0/24 dev enp0s8 proto kernel scope link src 192.168.56.42 metric 101
```
=> We zien duidelijk dat de default gateway correct is.

#### Connectiviteit

Kan je pingen naar een ander apparaat in het netwerk???

```
[vagrant@nginx ~]$ ping 172.22.10.29
PING 172.22.10.29 (172.22.10.29) 56(84) bytes of data.
64 bytes from 172.22.10.29: icmp_seq=1 ttl=63 time=0.520 ms
64 bytes from 172.22.10.29: icmp_seq=2 ttl=63 time=0.509 ms
^C
--- 172.22.10.29 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1005ms
```
=> Pingen naar host systeem lukt

#### Fouten in deze fase:
1. In de config file  ```/etc/sysconfig/network-scripts/ifcfg-enp0s8``` was IPADDR, IPADRR
  * Opossing: veranderen van IPADRR naar IPADDR met vi


### Phase 3: Transport layer
Verwachtingen:
* Netwerk service runt
* De poorten zijn correct en toegankelijk

#### Service Status
Controleren wat de status van de service is
Commando:
```
[vagrant@nginx ~]$ sudo systemctl status nginx.service
```
=> Service kan nog niet worden uitgevoert, fouten in config file. Oplossen in volgende fase.

Als service niet actief is:
* ``` systemctl start nginx``` & ``` systemctl enable nginx```

#### Firewall

Welke poorten worden gebruikt?
```
[vagrant@nginx ~]$ sudo ss -tlnp
```

Draait de Firewall?
```
[vagrant@nginx ~]$ sudo systemctl status firewalld
```

Firewall Config
```
[vagrant@nginx ~]$ sudo firewall-cmd --list-all
```
=> https poort ontbreekt, toevoegen:
```
[vagrant@nginx ~]$ sudo firewall-cmd --add-service=https --permanent
[vagrant@nginx ~]$ sudo firewall-cmd --reload
[vagrant@nginx ~]$ sudo firewall-cmd --list-all
```


#### Fouten in deze fase:
1. De service NGINX was niet actief
  * Opossing: Er zijn syntax fouten in config file, dit zal opgelost worden in de volgende laag, hierdoor kan nginx nog niet starten
2. HTTPS ontbreekt als service in firewall
  * ```$ sudo firewall-cmd --add-service=https --permanent```

### Phase 4: Application layer

Controleren syntax config file
```
[vagrant@nginx ~]$ sudo nginx -t
nginx: [emerg] BIO_new_file("/etc/pki/tls/certs/nigxn.pem") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen('/etc/pki/tls/certs/nigxn.pem','r') error:2006D080:BIO routines:BIO_new_file:no such file)
nginx: configuration file /etc/nginx/nginx.conf test failed

```
=> /etc/pki/tls/certs/nigxn.pem is verkeerd moet .../nignx.pem zijn
+ Poort 8433 moet 433 zijn!

Zijn de poorten toegankelijk van op host:
```
meeckhout@Dell-Maxim:~$ sudo nmap -sS -p 80,443 192.168.56.42

Starting Nmap 7.60 ( https://nmap.org ) at 2018-10-29 14:58 CET
Nmap scan report for 192.168.56.42
Host is up (0.00031s latency).

PORT    STATE SERVICE
80/tcp  open  http
443/tcp open  https
MAC Address: 08:00:27:B5:4A:BE (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.60 seconds
```
SELinux cheat sheet:
```
ls -Z /var/www/html
sudo restorecon -R /var/www/
sudo chcon -t httpd_sys_content_t index.php
getsebool -a
sudo setsebool -P httpd_can_network_connect_db on
```
#### Fouten in deze fase:
1. Fout in nginx.conf file
  * "ssl_certificate /etc/pki/tls/certs/nignx.pem;" moest "ssl_certificate /etc/pki/tls/certs/nginx.pem;" zijn
2. Fout in nginx.conf file
  * De poort moet 443 zijn in plaats van 8433
  ```
  listen 443 ssl;
  listen [::]:443 ssl;
  ```
## End result

Output van de tests:
```
[vagrant@nginx ~]$ sudo ./runbats.sh
Running test /home/vagrant/01-whitebox.bats
 ✓ The SELinux status should be ‘enforcing’
 ✓ The firewall should be running
 ✓ Apache should not be installed
 ✓ Apache should not be running

4 tests, 0 failures
Running test /home/vagrant/02-blackbox.bats
 ✓ The web server host should be reachable
 ✓ The website should be accessible through HTTP
 ✓ The website should be accessible through HTTPS

3 tests, 0 failures

```
Resultaat vanaf host systeem:
De http en https pagina zijn beide bereikbaar vanaf host systeem en geven beiden "Keep calm and vagrant up".

Geen erros meer.

## Resources

List all sources of useful information that you encountered while completing this assignment: books, manuals, HOWTO's, blog posts, etc.

* [Slides Github](https://hogenttin.github.io/elnx-syllabus/troubleshooting/#/title-slide)
* [Linux Troubleshooting](https://github.com/bertvv/linux-network-troubleshooting)
